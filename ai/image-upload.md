# План по внедрению загрузки файлов изображений в админ-панели

## Текущая ситуация

В текущей реализации админ-панели для загрузки изображений используются текстовые поля (input type="text"), куда администратор должен вводить URL-адреса изображений. Это создает следующие проблемы:

1. Неудобство использования: пользователь должен самостоятельно загружать изображения на внешний сервер и копировать URL
2. Высокий риск ошибок при вводе URL
3. Отсутствие предпросмотра изображений 
4. Отсутствие контроля над размерами и форматами загружаемых файлов

## Места где используются текстовые поля для ввода URL изображений

### 1. Услуги (Services)
- **Файл**: app/admin/services/[id]/page.tsx
- **Поля для замены**:
  - icon (URL иконки)
  - image (URL изображения)

### 2. Ткани (Fabrics)
- **Файл**: app/admin/fabrics/[id]/page.tsx
- **Поля для замены**:
  - image (URL изображения)

### 3. Галерея (Gallery)
- **Файл**: app/admin/gallery/[id]/page.tsx
- **Поля для замены**:
  - imageSrc (URL главного изображения)
  - details.additionalImages (список URL дополнительных изображений)

### 4. Отзывы (Testimonials)
- **Файл**: app/admin/testimonials/[id]/page.tsx
- **Поля для замены**:
  - avatar (URL аватара)

## Задачи для реализации

### 1. Создание компонента для загрузки файлов изображений

1. Создать универсальный компонент `ImageUpload`, который будет:
   - Принимать загрузку файлов через drag-and-drop и кнопку выбора файла
   - Отображать предпросмотр изображения
   - Проверять размер и формат файла
   - Показывать прогресс загрузки
   - Отображать сообщения об ошибках

### 2. Создание серверного API для загрузки изображений

1. Реализовать API-эндпоинт для загрузки файлов:
   - Использовать server action для обработки загрузки
   - Обеспечить валидацию файлов на стороне сервера
   - Сохранять файлы в соответствующую директорию на сервере или в облачное хранилище

### 3. Обновление форм для работы с изображениями

#### 3.1 Обновление формы услуг
- Заменить текстовые поля на компонент загрузки изображений
- Добавить предпросмотр текущих изображений
- Обновить обработчики формы для работы с загруженными файлами

#### 3.2 Обновление формы тканей
- Заменить текстовое поле на компонент загрузки изображений
- Добавить предпросмотр текущего изображения
- Обновить обработчики формы для работы с загруженными файлами

#### 3.3 Обновление формы галереи
- Заменить текстовые поля на компоненты загрузки изображений
- Добавить возможность множественной загрузки для дополнительных изображений
- Добавить предпросмотр текущих изображений
- Обновить обработчики формы для работы с загруженными файлами

#### 3.4 Обновление формы отзывов
- Заменить текстовое поле аватара на компонент загрузки изображений
- Добавить предпросмотр текущего аватара
- Обновить обработчики формы для работы с загруженным файлом

## Реализация

### Шаг 1: Создание компонента ImageUpload

Создать компонент `app/admin/components/ui/image-upload.tsx`:
- Компонент должен поддерживать одиночную и множественную загрузку изображений
- Включить предпросмотр изображений
- Добавить возможность удаления загруженных изображений
- Интегрировать с react-hook-form для удобного использования в формах

### Шаг 2: Создание API для загрузки изображений

Создать server action `app/actions/admin/upload.ts`:
- Реализовать функцию для обработки загрузки файлов
- Добавить проверку типов файлов
- Сохранять файлы в директорию `/public/uploads/` с подкаталогами по категориям
- Возвращать URL-адреса загруженных файлов

### Шаг 3: Обновление форм

Последовательно обновить формы в указанных файлах:
1. app/admin/services/[id]/page.tsx
2. app/admin/fabrics/[id]/page.tsx
3. app/admin/gallery/[id]/page.tsx
4. app/admin/testimonials/[id]/page.tsx

## План развертывания

1. Разработка и тестирование компонента загрузки изображений
2. Реализация server action для загрузки файлов
3. Последовательное обновление форм в порядке приоритета:
   - Услуги
   - Галерея
   - Ткани
   - Отзывы

## Ожидаемые результаты

- Улучшение пользовательского опыта администраторов
- Снижение количества ошибок при загрузке изображений
- Улучшение качества контента на сайте за счет контроля над загружаемыми изображениями

## Прогресс выполнения

- [x] Создан компонент ImageUpload
- [x] Реализован server action для загрузки файлов
- [x] Обновлена форма услуг
- [x] Обновлена форма тканей
- [x] Обновлена форма галереи
- [x] Обновлена форма отзывов

## Дополнительные улучшения (to-do)

1. **Множественная загрузка файлов**:
   - [ ] Реализовать полноценную поддержку множественной загрузки файлов для галереи
   - [ ] Создать компонент для отображения и управления несколькими изображениями

2. **Оптимизация изображений**:
   - [ ] Добавить оптимизацию изображений на стороне сервера
   - [ ] Реализовать создание миниатюр для быстрой загрузки

3. **Интеграция с облачным хранилищем**:
   - [ ] Добавить опцию загрузки изображений в облачное хранилище (AWS S3, Cloudinary и т.д.)
   - [ ] Реализовать кэширование и CDN для быстрой доставки изображений

4. **Улучшения UX**:
   - [ ] Добавить возможность обрезки и редактирования изображений перед загрузкой
   - [ ] Улучшить отображение прогресса загрузки
   - [ ] Добавить drag-and-drop для изменения порядка изображений

## Заметки по реализации

- Реализована базовая версия компонента загрузки с предпросмотром и валидацией
- Для тестирования необходима установка пакета uuid: `npm install uuid @types/uuid`
- Необходимо убедиться, что папка `/public/uploads/` доступна для записи
- Для полноценной работы с несколькими изображениями требуется дополнительная доработка
- В будущем рекомендуется использовать библиотеку react-hook-form для более удобной валидации форм 